name: build

on: [push, pull_request]

jobs:
  build:
    name: Build (${{ matrix.name }})
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        include:
          - name: linux
            os: ubuntu-22.04
            arch: x86_64
          - name: windows
            os: windows-latest
            arch: x86_64
          - name: macos-intel
            os: macos-15-intel
            arch: x86_64
          - name: macos-arm64
            os: macos-latest
            arch: arm64

    steps:
    - name: Set up Go
      uses: actions/setup-go@v5
      with:
        go-version: '1.24'

    - name: Checkout
      uses: actions/checkout@v4

    - name: Linux dependencies
      if: matrix.name == 'linux'
      run: sudo apt-get install -y libpango1.0-dev libpangocairo-1.0-0 libgdk-pixbuf2.0-dev libgtk-3-dev

    - name: Setup
      run: npm ci --no-audit

    - name: Build
      run: node release/build.js --target itch-setup --arch ${{ matrix.arch }} --skip-signing

    - name: Store
      uses: actions/upload-artifact@v4
      with:
        name: binaries-${{ matrix.name }}
        path: artifacts/itch-setup/
